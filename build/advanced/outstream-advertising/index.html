---
layout: default
title: Outstream Advertising
description: Trigger an in-read ad to autoplay once it comes into view and collapse the video player after ad completion.
published: true
---

<head>
    <link rel="shortcut icon" href="//developer.jwplayer.com/img/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="template-css/jw-demos.css">

    <link rel="stylesheet" href="../../template-css/jw-demos.css">
    <link rel="stylesheet" href="css/build.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="../../js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

{% include components/site-secondary-header/site-secondary-header.html product="player" %}


<div class="demos">

  <div class="demos-single-header">
    <div class="demos-single-header-container">
      <h1>Outstream Advertising</h1>
      <p>
        Trigger an in-read ad to autoplay once it comes into view and collapse the video player after ad completion.
      </p>
    </div>
  </div>

  <div class="demo-single">

    <div class="demo-nav">
      <div class="demo-back">
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="61.1px" height="100px" viewBox="31.7 11.5 61.1 100" style="enable-background:new 31.7 11.5 61.1 100;" xml:space="preserve">
          <path d="M89.6,14.7c4.3,4.3,4.3,11.3,0,15.5L58.4,61.5l31.2,31.2c4.3,4.3,4.3,11.3,0,15.5c-4.3,4.3-11.3,4.3-15.7,0l-39-39
          c-4.3-4.3-4.3-11.3,0-15.5l39.1-39C78.3,10.4,85.3,10.4,89.6,14.7z"/>
        </svg>
        <a href="../../">Back to Demos</a>
      </div>
      <div class="demo-meta">
        <div class="demo-license">
          License: <strong>Enterprise</strong>
        </div>
        <div class="demo-version">
          Player Version: <strong id="demo-player-version"></strong>
        </div>
          <div class="demo-author">
            Author: <strong>JW Player</strong>
              <span>| <a href="http://github.com/jwplayer">GitHub</a></span>
          </div>
      </div>
      <div class="demo-source-code">
        <a href="//github.com/jwplayer/jwdeveloper-demos/tree/master/demos/advanced/outstream-advertising">Source Code</a>
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100px" height="97.5px" viewBox="0 0 100 97.5" enable-background="new 0 0 100 97.5" xml:space="preserve">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M50,0C22.4,0,0,22.4,0,50c0,22.1,14.3,40.8,34.2,47.4
          	c2.5,0.5,3.4-1.1,3.4-2.4c0-1.2,0-4.3-0.1-8.5c-13.9,3-16.8-6.7-16.8-6.7c-2.3-5.8-5.6-7.3-5.6-7.3c-4.5-3.1,0.3-3,0.3-3
          	c5,0.4,7.7,5.2,7.7,5.2c4.5,7.6,11.7,5.4,14.6,4.2c0.5-3.2,1.7-5.4,3.2-6.7c-11.1-1.3-22.8-5.6-22.8-24.7c0-5.5,1.9-9.9,5.1-13.4
          	c-0.5-1.3-2.2-6.3,0.5-13.2c0,0,4.2-1.3,13.7,5.1c4-1.1,8.3-1.7,12.5-1.7c4.2,0,8.5,0.6,12.5,1.7c9.5-6.5,13.7-5.1,13.7-5.1
          	c2.7,6.9,1,12,0.5,13.2c3.2,3.5,5.1,8,5.1,13.4c0,19.2-11.7,23.4-22.8,24.7c1.8,1.5,3.4,4.6,3.4,9.3c0,6.7-0.1,12.1-0.1,13.7
          	c0,1.3,0.9,2.9,3.4,2.4C85.7,90.8,100,72.1,100,50C100,22.4,77.6,0,50,0z"/>
        </svg>
      </div>
    </div>

      <div class="demo-api-reference">
        <div class="demo-api-reference-link">
          <a href="/jw-player/docs/developer-guide/api/javascript_api_reference/">API Reference</a>
        </div>
        <div class="demo-api-calls-label">
          This demo includes:
        </div>
        <ul class="demo-api-calls">
            <li><code>on(&#39;complete&#39;)</code></li>
            <li><code>on(&#39;adComplete&#39;)</code></li>
            <li><code>on(&#39;adError&#39;)</code></li>
            <li><code>remove()</code></li>
        </ul>
      </div>

    <div class="demo-container">

      <div class="demo-layout-vertical">
        <div class="demo-layout-content">
          <script src="//content.jwplatform.com/libraries/lqsWlr4Z.js"></script>

<h1>Outstream Advertising</h1>

<p>This demo resembles a long blog post with an inline video ad. Scroll down to see the demo and JavaScript code.</p>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque dui ex, suscipit eu ultrices et, congue nec quam. Sed ultricies bibendum quam at sollicitudin. Mauris ut dapibus sapien. Sed turpis mauris, cursus in enim ut, sodales tempus tortor. Donec varius aliquam massa. Donec fermentum pellentesque molestie. Integer varius porta vehicula. Etiam volutpat nibh et nisl malesuada, vel auctor tellus commodo. Aliquam quis pharetra diam. Aliquam efficitur molestie viverra. Curabitur eu vulputate odio. Praesent sollicitudin tincidunt rhoncus. Phasellus nunc metus, blandit quis arcu at, feugiat viverra lorem. Phasellus sollicitudin augue at tincidunt ullamcorper. Quisque non ipsum augue.</p>

<p>Donec eget urna sit amet tellus varius efficitur ac sodales lorem. Nullam id elit eros. Etiam finibus nunc vel ante condimentum, eu ullamcorper lorem commodo. Maecenas pretium, nulla id iaculis convallis, lectus dui feugiat arcu, sit amet placerat augue turpis quis ante. Sed sit amet ornare dui. Ut maximus suscipit dictum. Fusce vitae justo tortor. Cras ac vestibulum augue, sed tristique felis. Nam tincidunt sapien velit, dignissim tempus justo laoreet in.</p>

<div class="jw-ad">
  <div class="jw-ad-label">Advertisement</div>
	<div class="jw-ad-media-container">
  	<div id="player"></div>
  </div>
</div>

<p>Vivamus eleifend congue lectus, quis ullamcorper tortor accumsan non. Duis vitae mattis tortor. Nulla vitae odio enim. Praesent eu orci at elit venenatis luctus. Praesent at luctus mauris. Maecenas accumsan posuere varius. Suspendisse id vehicula mauris. Vestibulum id neque vitae dui lobortis eleifend non sed erat. Nunc posuere augue nec turpis ornare facilisis. Vivamus lectus justo, commodo sed molestie consequat, dictum sed est. Maecenas semper velit placerat ex finibus rhoncus. Duis nisi justo, pharetra ac ipsum ac, gravida venenatis risus. Praesent eu est ultrices, lobortis felis quis, volutpat augue. Mauris non varius lacus. Etiam pulvinar ornare lectus et tristique.</p>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque dui ex, suscipit eu ultrices et, congue nec quam. Sed ultricies bibendum quam at sollicitudin. Mauris ut dapibus sapien. Sed turpis mauris, cursus in enim ut, sodales tempus tortor. Donec varius aliquam massa. Donec fermentum pellentesque molestie. Integer varius porta vehicula. Etiam volutpat nibh et nisl malesuada, vel auctor tellus commodo. Aliquam quis pharetra diam. Aliquam efficitur molestie viverra. Curabitur eu vulputate odio. Praesent sollicitudin tincidunt rhoncus. Phasellus nunc metus, blandit quis arcu at, feugiat viverra lorem. Phasellus sollicitudin augue at tincidunt ullamcorper. Quisque non ipsum augue.</p>

<p>Donec eget urna sit amet tellus varius efficitur ac sodales lorem. Nullam id elit eros. Etiam finibus nunc vel ante condimentum, eu ullamcorper lorem commodo. Maecenas pretium, nulla id iaculis convallis, lectus dui feugiat arcu, sit amet placerat augue turpis quis ante. Sed sit amet ornare dui. Ut maximus suscipit dictum. Fusce vitae justo tortor. Cras ac vestibulum augue, sed tristique felis. Nam tincidunt sapien velit, dignissim tempus justo laoreet in.</p>

        </div>
          <div class="demo-layout-code">
            <pre><code class="html">&lt;script type=&quot;text/javascript&quot;&gt;
&#x2F;&#x2F; math functions related to scroll and offset positions relative to player
var getScrollTop = function() {
	var documentEl = document.documentElement;
	return (window.pageYOffset || documentEl.scrollTop) - (documentEl.clientTop || 0);
};
var getElementOffsetTop = function(el) {
	var bodyRect = document.body.getBoundingClientRect(),
		elRect = el.getBoundingClientRect();
	return elRect.top - bodyRect.top;
};
var	getAdInView = function() {
	var scrollBoundary = playerOffsetTop + (playerHeight &#x2F; 2),
		scrollTop = getScrollTop();
	return (window.innerHeight + scrollTop) &gt; scrollBoundary &amp;&amp; scrollTop &lt; scrollBoundary;
};

&#x2F;&#x2F; cross-browser event binding method
var setEventListener = function(el, ev, fn) {
	var eventMethod = window.addEventListener ? &#39;addEventListener&#39; : &#39;attachEvent&#39;,
		eventName = window.addEventListener ? ev : &#39;on&#39; + ev;
	el[eventMethod](eventName, fn, false);
};

&#x2F;&#x2F; get element margin top and bottom totat height
var getMarginHeight = function(el) {
	if (document.all) {
		return parseInt(el.currentStyle.marginTop, 10) + parseInt(el.currentStyle.marginBottom, 10);
	} else {
		return parseInt(document.defaultView.getComputedStyle(el, &#39;&#39;).getPropertyValue(&#39;margin-top&#39;)) + parseInt(document.defaultView.getComputedStyle(el, &#39;&#39;).getPropertyValue(&#39;margin-bottom&#39;));
	}
};

&#x2F;&#x2F; check if ad is in view, ad visible class when necessary (but only the first time it&#39;s in view)
var setAdDisplayState = function() {
	if (getAdInView()) {
		if (!new RegExp(&#39;(^| )jw-ad-visible( |$)&#39;, &#39;gi&#39;).test(adEl.className)) {
			adEl.className += (adEl.className ? &#39; &#39; : &#39;&#39;) + &#39;jw-ad-visible&#39;;
			adEl.style.maxHeight = adLabelEl.offsetHeight + getMarginHeight(adLabelEl) + adMediaContainerEl.offsetHeight + getMarginHeight(adMediaContainerEl) + &#39;px&#39;;
		}
		if (playerInstance.getState() === &#39;idle&#39; || playerInstance.getState() === &#39;paused&#39;) {
			setTimeout(function() {
				playerInstance.play();
			}, 0);
		}
	} else {
		if (playerInstance.getState() === &#39;playing&#39;) {
			setTimeout(function() {
				playerInstance.pause();
			}, 0);
		}
	}
};

&#x2F;&#x2F; player elements and utility vars
var playerInstance = jwplayer(&#39;player&#39;),
	adEl = document.querySelector(&#39;.jw-ad&#39;),
	adLabelEl = document.querySelector(&#39;.jw-ad-label&#39;),
  adMediaContainerEl = document.querySelector(&#39;.jw-ad-media-container&#39;),
  playerHeight,
  playerOffsetTop = getElementOffsetTop(adEl),
	isScrollTimeout = false; &#x2F;&#x2F; namespace for whether or not we are waiting for setTimeout() to finish

&#x2F;&#x2F; player setup
playerInstance.setup({
  file: &#39;http:&#x2F;&#x2F;content.jwplatform.com&#x2F;videos&#x2F;mX3zaT5H-Zq6530MP.mp4&#39;,
  advertising: {
    client: &#39;vast&#39;,
    tag: &#39;https:&#x2F;&#x2F;playertest.longtailvideo.com&#x2F;vast-30s-ad.xml&#39;
  }
});

playerInstance.on(&#39;ready&#39;, function() {

	&#x2F;&#x2F; get player container height
	playerHeight = adMediaContainerEl.offsetHeight;

	&#x2F;&#x2F; mute by default
	playerInstance.setMute(true);

	&#x2F;&#x2F; unmute&#x2F;mute player on adMediaContainerEl mouse enter&#x2F;leave
	setEventListener(adMediaContainerEl, &#39;mouseenter&#39;, function() {
		playerInstance.setMute(false);
	});

	setEventListener(adMediaContainerEl, &#39;mouseleave&#39;, function() {
		playerInstance.setMute(true);
	});

	&#x2F;&#x2F; handle ad display state on page load
	setTimeout(setAdDisplayState(), 1000);

  &#x2F;&#x2F; attach scroll event listener to window
  setEventListener(window, &#39;scroll&#39;, function() {
		&#x2F;&#x2F; skip if we&#39;re waiting on a scroll update timeout to finish
		if (isScrollTimeout) return;
		&#x2F;&#x2F; flag that a new timeout will begin
		isScrollTimeout = true;
		&#x2F;&#x2F; otherwise, execute scroll event handler
		setAdDisplayState();
		&#x2F;&#x2F; set new timeout
		setTimeout(function() {
			&#x2F;&#x2F; reset timeout flag to false (no longer waiting)
			isScrollTimeout = false;
		}, 100);
  });
});

&#x2F;&#x2F; handle when ad is complete or encounters error
playerInstance.on(&#39;complete adComplete adError&#39;, function() {
	adEl.style.maxHeight = &#39;0px&#39;;
  setTimeout(function() {
    playerInstance.remove();
    adMediaContainerEl.parentNode.removeChild(adMediaContainerEl);
  }, 500 &#x2F;* should be the same duration as css transition *&#x2F;);
});

&#x2F;&#x2F; math functions related to scroll and offset positions relative to player
var getScrollTop = function() {
	var documentEl = document.documentElement;
	return (window.pageYOffset || documentEl.scrollTop) - (documentEl.clientTop || 0);
};
var getElementOffsetTop = function(el) {
	var bodyRect = document.body.getBoundingClientRect(),
		elRect = el.getBoundingClientRect();
	return elRect.top - bodyRect.top;
};
var	getAdInView = function() {
	var scrollBoundary = playerOffsetTop + (playerHeight &#x2F; 2),
		scrollTop = getScrollTop();
	return (window.innerHeight + scrollTop) &gt; scrollBoundary &amp;&amp; scrollTop &lt; scrollBoundary;
};

&#x2F;&#x2F; cross-browser event binding method
var setEventListener = function(el, ev, fn) {
	var eventMethod = window.addEventListener ? &#39;addEventListener&#39; : &#39;attachEvent&#39;,
		eventName = window.addEventListener ? ev : &#39;on&#39; + ev;
	el[eventMethod](eventName, fn, false);
};

&#x2F;&#x2F; get element margin top and bottom totat height
var getMarginHeight = function(el) {
	if (document.all) {
		return parseInt(el.currentStyle.marginTop, 10) + parseInt(el.currentStyle.marginBottom, 10);
	} else {
		return parseInt(document.defaultView.getComputedStyle(el, &#39;&#39;).getPropertyValue(&#39;margin-top&#39;)) + parseInt(document.defaultView.getComputedStyle(el, &#39;&#39;).getPropertyValue(&#39;margin-bottom&#39;));
	}
};

&#x2F;&#x2F; check if ad is in view, ad visible class when necessary (but only the first time it&#39;s in view)
var setAdDisplayState = function() {
	if (getAdInView()) {
		if (!new RegExp(&#39;(^| )jw-ad-visible( |$)&#39;, &#39;gi&#39;).test(adEl.className)) {
			adEl.className += (adEl.className ? &#39; &#39; : &#39;&#39;) + &#39;jw-ad-visible&#39;;
			adEl.style.maxHeight = adLabelEl.offsetHeight + getMarginHeight(adLabelEl) + adMediaContainerEl.offsetHeight + getMarginHeight(adMediaContainerEl) + &#39;px&#39;;
		}
		if (playerInstance.getState() === &#39;idle&#39; || playerInstance.getState() === &#39;paused&#39;) {
			setTimeout(function() {
				playerInstance.play();
			}, 0);
		}
	} else {
		if (playerInstance.getState() === &#39;playing&#39;) {
			setTimeout(function() {
				playerInstance.pause();
			}, 0);
		}
	}
};

&#x2F;&#x2F; player elements and utility vars
var playerInstance = jwplayer(&#39;player&#39;),
	adEl = document.querySelector(&#39;.jw-ad&#39;),
	adLabelEl = document.querySelector(&#39;.jw-ad-label&#39;),
  adMediaContainerEl = document.querySelector(&#39;.jw-ad-media-container&#39;),
  playerHeight,
  playerOffsetTop = getElementOffsetTop(adEl),
	isScrollTimeout = false; &#x2F;&#x2F; namespace for whether or not we are waiting for setTimeout() to finish

&#x2F;&#x2F; player setup
playerInstance.setup({
  file: &#39;http:&#x2F;&#x2F;content.jwplatform.com&#x2F;videos&#x2F;mX3zaT5H-Zq6530MP.mp4&#39;,
  advertising: {
    client: &#39;vast&#39;,
    tag: &#39;https:&#x2F;&#x2F;playertest.longtailvideo.com&#x2F;vast-30s-ad.xml&#39;
  }
});

playerInstance.on(&#39;ready&#39;, function() {

	&#x2F;&#x2F; get player container height
	playerHeight = adMediaContainerEl.offsetHeight;

	&#x2F;&#x2F; mute by default
	playerInstance.setMute(true);

	&#x2F;&#x2F; unmute&#x2F;mute player on adMediaContainerEl mouse enter&#x2F;leave
	setEventListener(adMediaContainerEl, &#39;mouseenter&#39;, function() {
		playerInstance.setMute(false);
	});

	setEventListener(adMediaContainerEl, &#39;mouseleave&#39;, function() {
		playerInstance.setMute(true);
	});

	&#x2F;&#x2F; handle ad display state on page load
	setTimeout(setAdDisplayState(), 1000);

  &#x2F;&#x2F; attach scroll event listener to window
  setEventListener(window, &#39;scroll&#39;, function() {
		&#x2F;&#x2F; skip if we&#39;re waiting on a scroll update timeout to finish
		if (isScrollTimeout) return;
		&#x2F;&#x2F; flag that a new timeout will begin
		isScrollTimeout = true;
		&#x2F;&#x2F; otherwise, execute scroll event handler
		setAdDisplayState();
		&#x2F;&#x2F; set new timeout
		setTimeout(function() {
			&#x2F;&#x2F; reset timeout flag to false (no longer waiting)
			isScrollTimeout = false;
		}, 100);
  });
});

&#x2F;&#x2F; handle when ad is complete or encounters error
playerInstance.on(&#39;complete adComplete adError&#39;, function() {
	adEl.style.maxHeight = &#39;0px&#39;;
  setTimeout(function() {
    playerInstance.remove();
    adMediaContainerEl.parentNode.removeChild(adMediaContainerEl);
  }, 500 &#x2F;* should be the same duration as css transition *&#x2F;);
});
&lt;/script&gt;</code></pre>
          </div>
      </div>

      <div class="demo-disclaimer">
        Please Note: This player implementation is a Proof of Concept only provided to show the possibilities of the JW Player and Platform and should not be taken as an offer to create, edit or maintain custom integration or development.
      </div>

    </div>

  </div>

</div>

          </div>
        </div>
      </div>
    </div>
<script type="text/javascript">
// math functions related to scroll and offset positions relative to player
var getScrollTop = function() {
	var documentEl = document.documentElement;
	return (window.pageYOffset || documentEl.scrollTop) - (documentEl.clientTop || 0);
};
var getElementOffsetTop = function(el) {
	var bodyRect = document.body.getBoundingClientRect(),
		elRect = el.getBoundingClientRect();
	return elRect.top - bodyRect.top;
};
var	getAdInView = function() {
	var scrollBoundary = playerOffsetTop + (playerHeight / 2),
		scrollTop = getScrollTop();
	return (window.innerHeight + scrollTop) > scrollBoundary && scrollTop < scrollBoundary;
};

// cross-browser event binding method
var setEventListener = function(el, ev, fn) {
	var eventMethod = window.addEventListener ? 'addEventListener' : 'attachEvent',
		eventName = window.addEventListener ? ev : 'on' + ev;
	el[eventMethod](eventName, fn, false);
};

// get element margin top and bottom totat height
var getMarginHeight = function(el) {
	if (document.all) {
		return parseInt(el.currentStyle.marginTop, 10) + parseInt(el.currentStyle.marginBottom, 10);
	} else {
		return parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-top')) + parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-bottom'));
	}
};

// check if ad is in view, ad visible class when necessary (but only the first time it's in view)
var setAdDisplayState = function() {
	if (getAdInView()) {
		if (!new RegExp('(^| )jw-ad-visible( |$)', 'gi').test(adEl.className)) {
			adEl.className += (adEl.className ? ' ' : '') + 'jw-ad-visible';
			adEl.style.maxHeight = adLabelEl.offsetHeight + getMarginHeight(adLabelEl) + adMediaContainerEl.offsetHeight + getMarginHeight(adMediaContainerEl) + 'px';
		}
		if (playerInstance.getState() === 'idle' || playerInstance.getState() === 'paused') {
			setTimeout(function() {
				playerInstance.play();
			}, 0);
		}
	} else {
		if (playerInstance.getState() === 'playing') {
			setTimeout(function() {
				playerInstance.pause();
			}, 0);
		}
	}
};

// player elements and utility vars
var playerInstance = jwplayer('player'),
	adEl = document.querySelector('.jw-ad'),
	adLabelEl = document.querySelector('.jw-ad-label'),
  adMediaContainerEl = document.querySelector('.jw-ad-media-container'),
  playerHeight,
  playerOffsetTop = getElementOffsetTop(adEl),
	isScrollTimeout = false; // namespace for whether or not we are waiting for setTimeout() to finish

// player setup
playerInstance.setup({
  file: 'http://content.jwplatform.com/videos/mX3zaT5H-Zq6530MP.mp4',
  advertising: {
    client: 'vast',
    tag: 'https://playertest.longtailvideo.com/vast-30s-ad.xml'
  }
});

playerInstance.on('ready', function() {

	// get player container height
	playerHeight = adMediaContainerEl.offsetHeight;

	// mute by default
	playerInstance.setMute(true);

	// unmute/mute player on adMediaContainerEl mouse enter/leave
	setEventListener(adMediaContainerEl, 'mouseenter', function() {
		playerInstance.setMute(false);
	});

	setEventListener(adMediaContainerEl, 'mouseleave', function() {
		playerInstance.setMute(true);
	});

	// handle ad display state on page load
	setTimeout(setAdDisplayState(), 1000);

  // attach scroll event listener to window
  setEventListener(window, 'scroll', function() {
		// skip if we're waiting on a scroll update timeout to finish
		if (isScrollTimeout) return;
		// flag that a new timeout will begin
		isScrollTimeout = true;
		// otherwise, execute scroll event handler
		setAdDisplayState();
		// set new timeout
		setTimeout(function() {
			// reset timeout flag to false (no longer waiting)
			isScrollTimeout = false;
		}, 100);
  });
});

// handle when ad is complete or encounters error
playerInstance.on('complete adComplete adError', function() {
	adEl.style.maxHeight = '0px';
  setTimeout(function() {
    playerInstance.remove();
    adMediaContainerEl.parentNode.removeChild(adMediaContainerEl);
  }, 500 /* should be the same duration as css transition */);
});

// math functions related to scroll and offset positions relative to player
var getScrollTop = function() {
	var documentEl = document.documentElement;
	return (window.pageYOffset || documentEl.scrollTop) - (documentEl.clientTop || 0);
};
var getElementOffsetTop = function(el) {
	var bodyRect = document.body.getBoundingClientRect(),
		elRect = el.getBoundingClientRect();
	return elRect.top - bodyRect.top;
};
var	getAdInView = function() {
	var scrollBoundary = playerOffsetTop + (playerHeight / 2),
		scrollTop = getScrollTop();
	return (window.innerHeight + scrollTop) > scrollBoundary && scrollTop < scrollBoundary;
};

// cross-browser event binding method
var setEventListener = function(el, ev, fn) {
	var eventMethod = window.addEventListener ? 'addEventListener' : 'attachEvent',
		eventName = window.addEventListener ? ev : 'on' + ev;
	el[eventMethod](eventName, fn, false);
};

// get element margin top and bottom totat height
var getMarginHeight = function(el) {
	if (document.all) {
		return parseInt(el.currentStyle.marginTop, 10) + parseInt(el.currentStyle.marginBottom, 10);
	} else {
		return parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-top')) + parseInt(document.defaultView.getComputedStyle(el, '').getPropertyValue('margin-bottom'));
	}
};

// check if ad is in view, ad visible class when necessary (but only the first time it's in view)
var setAdDisplayState = function() {
	if (getAdInView()) {
		if (!new RegExp('(^| )jw-ad-visible( |$)', 'gi').test(adEl.className)) {
			adEl.className += (adEl.className ? ' ' : '') + 'jw-ad-visible';
			adEl.style.maxHeight = adLabelEl.offsetHeight + getMarginHeight(adLabelEl) + adMediaContainerEl.offsetHeight + getMarginHeight(adMediaContainerEl) + 'px';
		}
		if (playerInstance.getState() === 'idle' || playerInstance.getState() === 'paused') {
			setTimeout(function() {
				playerInstance.play();
			}, 0);
		}
	} else {
		if (playerInstance.getState() === 'playing') {
			setTimeout(function() {
				playerInstance.pause();
			}, 0);
		}
	}
};

// player elements and utility vars
var playerInstance = jwplayer('player'),
	adEl = document.querySelector('.jw-ad'),
	adLabelEl = document.querySelector('.jw-ad-label'),
  adMediaContainerEl = document.querySelector('.jw-ad-media-container'),
  playerHeight,
  playerOffsetTop = getElementOffsetTop(adEl),
	isScrollTimeout = false; // namespace for whether or not we are waiting for setTimeout() to finish

// player setup
playerInstance.setup({
  file: 'http://content.jwplatform.com/videos/mX3zaT5H-Zq6530MP.mp4',
  advertising: {
    client: 'vast',
    tag: 'https://playertest.longtailvideo.com/vast-30s-ad.xml'
  }
});

playerInstance.on('ready', function() {

	// get player container height
	playerHeight = adMediaContainerEl.offsetHeight;

	// mute by default
	playerInstance.setMute(true);

	// unmute/mute player on adMediaContainerEl mouse enter/leave
	setEventListener(adMediaContainerEl, 'mouseenter', function() {
		playerInstance.setMute(false);
	});

	setEventListener(adMediaContainerEl, 'mouseleave', function() {
		playerInstance.setMute(true);
	});

	// handle ad display state on page load
	setTimeout(setAdDisplayState(), 1000);

  // attach scroll event listener to window
  setEventListener(window, 'scroll', function() {
		// skip if we're waiting on a scroll update timeout to finish
		if (isScrollTimeout) return;
		// flag that a new timeout will begin
		isScrollTimeout = true;
		// otherwise, execute scroll event handler
		setAdDisplayState();
		// set new timeout
		setTimeout(function() {
			// reset timeout flag to false (no longer waiting)
			isScrollTimeout = false;
		}, 100);
  });
});

// handle when ad is complete or encounters error
playerInstance.on('complete adComplete adError', function() {
	adEl.style.maxHeight = '0px';
  setTimeout(function() {
    playerInstance.remove();
    adMediaContainerEl.parentNode.removeChild(adMediaContainerEl);
  }, 500 /* should be the same duration as css transition */);
});
</script>
<script type="text/javascript">
  function setVersion() {
    if (typeof jwplayer === 'undefined') {
      setTimeout(setVersion, 100);
      return;
    }

    if (jwplayer && jwplayer().id) {
      jwplayer().on('ready', function() {
        document.getElementById('demo-player-version').innerHTML = jwplayer.version.split('+')[0];
      });
    }
  }

  setVersion();
</script>
  </body>
</html>
